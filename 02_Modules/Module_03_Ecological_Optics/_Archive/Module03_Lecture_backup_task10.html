<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecological Optics: Geometry of Information</title>
    <link rel="stylesheet" href="https://api.fontshare.com/v2/css?f[]=satoshi@900,700,500,400&display=swap">
    <style>
        :root {
            --bg: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #64748b;
            --accent: #3b82f6;
            --line-color: #e2e8f0;
            --font-main: 'Satoshi', sans-serif;
            --slide-padding: clamp(2rem, 8vw, 6rem);
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html {
            scroll-behavior: smooth;
            scroll-snap-type: y mandatory;
            background: var(--bg);
        }

        body {
            font-family: var(--font-main);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* Slide Layout */
        .slide {
            min-height: 100vh;
            width: 100vw;
            padding: var(--slide-padding);
            scroll-snap-align: start;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            border-bottom: 1px solid var(--line-color);
        }

        .slide-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Typography */
        h1 {
            font-size: clamp(3rem, 10vw, 6rem);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: -0.04em;
            margin-bottom: 1.5rem;
        }

        h2 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            letter-spacing: -0.03em;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        p, li {
            font-size: clamp(1.1rem, 2vw, 1.5rem);
            color: var(--text-secondary);
            margin-bottom: 1rem;
            max-width: 800px;
        }

        ul {
            list-style: none;
            margin-bottom: 2rem;
        }

        li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.75rem;
        }

        li::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0.7em;
            width: 8px;
            height: 2px;
            background: var(--accent);
        }

        /* Media */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
            align-items: center;
        }

        .img-container {
            background: #fff;
            padding: 10px;
            border: 1px solid var(--line-color);
            border-radius: 4px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        img {
            width: 100%;
            height: auto;
            display: block;
            transition: filter 0.5s ease;
        }

        /* Demo Container Styles */
        .demo-container {
            width: 100%;
            max-width: 1200px;
            margin: 2rem auto;
            border: 2px solid var(--line-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .demo-container iframe {
            display: block;
            border: none;
            background: #fff;
        }

        /* Ensure demos are visible in presenter mode */
        body.is-presenter .demo-container {
            transform: scale(0.6);
            transform-origin: top left;
        }

        /* Animations */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
        }

        .visible .reveal {
            opacity: 1;
            transform: translateY(0);
        }

        .reveal:nth-child(1) { transition-delay: 0.1s; }
        .reveal:nth-child(2) { transition-delay: 0.2s; }
        .reveal:nth-child(3) { transition-delay: 0.3s; }
        .reveal:nth-child(4) { transition-delay: 0.4s; }
        .reveal:nth-child(5) { transition-delay: 0.5s; }

        /* Navigation */
        .nav-dots {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 100;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--text-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dot.active {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.3);
        }

        .progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--accent);
            z-index: 1000;
            transition: width 0.1s linear;
        }

        /* Notes Overlay (Toggle with 'N') */
        .notes-panel {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border: 1px solid var(--line-color);
            border-left: 4px solid var(--accent);
            max-width: 400px;
            z-index: 50;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .notes-panel.active { display: block; }
        .notes-label { font-size: 0.8rem; font-weight: 700; color: var(--accent); text-transform: uppercase; margin-bottom: 0.5rem; display: block; }

        /* Presenter View Styles */
        .presenter-ui {
            display: none;
            position: fixed;
            inset: 0;
            background: #0f172a;
            color: #fff;
            padding: 3rem;
            z-index: 9999;
            grid-template-columns: 1fr 350px;
            grid-template-rows: auto 1fr auto;
            gap: 2rem;
        }

        body.is-presenter .presenter-ui { display: grid; }
        body.is-presenter .slide, body.is-presenter .nav-dots, body.is-presenter .progress { display: none; }

        .p-current-box { grid-column: 1; grid-row: 2; background: #1e293b; border-radius: 20px; padding: 2rem; border: 1px solid #334155; height: 100%; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .p-notes-box { grid-column: 2; grid-row: 2; background: #1e293b; border-radius: 20px; padding: 2rem; border: 1px solid #334155; overflow-y: auto; font-size: 1.2rem; line-height: 1.5; color: #cbd5e1; }
        .p-next-box { grid-column: 1 / span 2; grid-row: 3; background: #0f172a; border-top: 1px solid #334155; padding-top: 1rem; color: #94a3b8; font-family: monospace; }
        .p-meta { grid-column: 1 / span 2; grid-row: 1; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; padding-bottom: 1rem; }
        .p-timer { font-family: monospace; font-size: 2rem; color: var(--accent); }

        /* Scale down content for presenter preview */
        .p-current-box .slide-content { transform: scale(0.6); transform-origin: center; width: 100%; }

        @media (max-width: 768px) {
            :root { --slide-padding: 2rem; }
            .nav-dots { display: none; }
        }
    </style>
</head>
<body>
    <div class="progress" id="progressBar"></div>
    <nav class="nav-dots" id="navDots"></nav>
    <div class="notes-panel" id="notesPanel">
        <span class="notes-label">Speaker Notes</span>
        <div id="notesContent"></div>
    </div>

    <!-- Presenter UI Overlay -->
    <div class="presenter-ui">
        <div class="p-meta">
            <div><span class="notes-label">Presenter Mode</span><h2 id="pSlideNum" style="margin:0; font-size: 1.5rem;">Slide 1</h2></div>
            <div class="p-timer" id="pTimer">00:00:00</div>
        </div>
        <div class="p-current-box" id="pCurrentBox">
            <!-- Content Injected Here -->
        </div>
        <div class="p-notes-box">
            <span class="notes-label">Notes</span>
            <div id="pNotes"></div>
        </div>
        <div class="p-next-box">
            <span class="notes-label">Next Up</span>
            <div id="pNextContent"></div>
        </div>
    </div>

    <!-- Slide 1 -->
    <section class="slide" data-notes="Transition from 'Axioms' (Theory) to 'Mechanics' (How it works). Today is about how light carries information.">
        <div class="slide-content">
            <h3 class="reveal">Module 03: Ecological Optics</h3>
            <h1 class="reveal">The Geometry of Information</h1>
            <div style="width: 80px; height: 6px; background: var(--accent); margin-top: 2rem;" class="reveal"></div>
        </div>
    </section>

    <!-- Slide 2 -->
    <section class="slide" data-notes="The main point is that it's not all about running. Visual perception makes locomotion truly useful because we can orient to distal objects. This lecture focuses on the visual control of locomotion with particular emphasis on Gibson's rules and current research.">
        <div class="slide-content">
            <h2 class="reveal">The Diversity of Locomotion</h2>
            <h3 class="reveal">Movement Across the Animal Kingdom</h3>
            <ul class="reveal">
                <li>Crawling</li>
                <li>Flying</li>
                <li>Hopping</li>
                <li>Walking</li>
                <li>Running</li>
                <li>Swimming</li>
            </ul>
        </div>
    </section>

    <!-- Slide 3 -->
    <section class="slide" data-notes="This demonstrates how objects can be perceived purely through motion and texture accretion/deletion at edges. Notice how depth and form emerge from movement alone - no static luminance boundaries required.">
        <div class="slide-content">
            <h2 class="reveal">Interactive Demo - Kinetic Occlusion</h2>
            <h3 class="reveal">Objects Defined by Motion</h3>
            <div class="demo-container reveal">
                <iframe src="demos/kinetic_occlusion/index.html" width="100%" height="600px" frameborder="0"></iframe>
            </div>
        </div>
    </section>

    <!-- Slide 4 -->
    <section class="slide" data-notes="This establishes the ecological approach to locomotion. We're not computing, we're detecting lawful relationships between optical structure and movement possibilities.">
        <div class="slide-content">
            <h2 class="reveal">Ecological Context</h2>
            <h3 class="reveal">Major Premises for Locomotion Regulation</h3>
            <ul class="reveal">
                <li><strong>Ambient energy arrays</strong> (optic array specifically) have structure</li>
                <li>This <strong>structure is information</strong> available to organisms with perceptual systems</li>
                <li><strong>Detection occurs directly</strong> - no internal mediational states needed</li>
                <li><strong>Example:</strong> Optic flow fields are used for behavioral control without "high-level processing, storage, or representation"</li>
            </ul>
        </div>
    </section>

    <!-- Slide 5 -->
    <section class="slide" data-notes="Blau & Wagman (Ch 6). Physics cares about photons/energy. Perception cares about structure (edges, texture, occlusion). The 'Optic Array' is this structured arrangement of angles at the eye.">
        <div class="slide-content">
            <h2 class="reveal">The Core Problem</h2>
            <h3 class="reveal">Radiant vs. Ambient Light</h3>
            <div class="grid reveal">
                <div>
                    <p><strong>Radiant Light:</strong> Physics. Energy radiating from a source. Homogeneous.</p>
                </div>
                <div style="border-left: 2px solid var(--line-color); padding-left: 2rem;">
                    <p><strong>Ambient Light:</strong> Ecology. Light reflected and structured by the environment. Heterogeneous.</p>
                </div>
            </div>
            <p class="reveal" style="font-weight: 700;"><strong>Key Concept:</strong> We don't see light; we see <em>by means of</em> light.</p>
        </div>
    </section>

    <!-- Slide 6 -->
    <section class="slide" data-notes="Gibson proposed these 'rules' to show how specific optical invariants control specific actions. Each rule links a perceptual variable to an action outcome. We will test these empirically throughout today's lecture.">
        <div class="slide-content">
            <h2 class="reveal">Gibson's Rules for Visual Guidance</h2>
            <h3 class="reveal">Optical Invariants for Locomotor Control</h3>
            <ul class="reveal">
                <li><strong>To be still:</strong> Minimize change in the optic flow (Nonflow = stationary)</li>
                <li><strong>To move forward/backward:</strong> Produce global outflow/inflow (Outflow = forward movement)</li>
                <li><strong>To move to a target:</strong> Place the Focus of Expansion (FOE) on the target</li>
                <li><strong>To change direction:</strong> Change the location of the FOE from its previous position</li>
                <li><strong>To approach without collision:</strong> Keep rate of object expansion (Tau) steady</li>
            </ul>
        </div>
    </section>

    <!-- Slide 7 -->
    <section class="slide" data-notes="This demonstrates Rules 2-4. Move the mouse to change heading direction - notice how the FOE moves with it. Adjust speeds to see how different rates of expansion affect the perception of time-to-contact. Try placing the FOE on the doorway edges to simulate steering.">
        <div class="slide-content">
            <h2 class="reveal">Interactive Demo - Optic Flow</h2>
            <h3 class="reveal">Radial Expansion and Focus of Expansion (FOE)</h3>
            <div class="demo-container reveal">
                <iframe src="demos/optic_flow/index.html" width="100%" height="600px" frameborder="0"></iframe>
            </div>
            <p class="reveal"><strong>Controls:</strong></p>
            <ul class="reveal">
                <li>Mouse: Move heading (FOE)</li>
                <li>Arrows: Star speed</li>
                <li>F/J: Doorway speed</li>
                <li>R: Sync speeds</li>
            </ul>
        </div>
    </section>

    <!-- Slide 8 -->
    <section class="slide" data-notes="Vision dominates mechanical proprioception. If the room moves forward, you feel like you are swaying backward, so you lean forward to 'correct' it—and fall.">
        <div class="slide-content">
            <h3 class="reveal">Rule 1: Visual Proprioception</h3>
            <h2 class="reveal">The Moving Room (Lee & Lishman, 1974)</h2>
            <ul class="reveal">
                <li><strong>Question:</strong> Does vision tell us about the world (exteroception) or ourselves (proprioception)?</li>
                <li><strong>Experiment:</strong> Move the walls, keep the floor still.</li>
                <li><strong>Result:</strong> Infants (and adults) sway or fall to compensate for illusory self-motion.</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_6_img_1.png" alt="Moving Room Setup"></div>
                <div class="img-container"><img src="assets/slide_6_img_2.png" alt="Sway Data"></div>
            </div>
        </div>
    </section>

    <!-- Slide 9 -->
    <section class="slide" data-notes="It's not just 'flow'; the geometry matters. Peripheral flow (parallel/lamellar) specifies egomotion more robustly than central flow.">
        <div class="slide-content">
            <h3 class="reveal">Refining Proprioception</h3>
            <h2 class="reveal">Central vs. Peripheral Flow (Stoffregen, 1985)</h2>
            <ul class="reveal">
                <li><strong>Question:</strong> Which part of the retina controls balance?</li>
                <li><strong>Finding:</strong> Peripheral flow (Lamellar) has a stronger influence on stance than central flow (Radial).</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_8_img_2.png" alt="Stoffregen Diagrams"></div>
                <div class="img-container"><img src="assets/slide_8_img_4.png" alt="Sway Correlations"></div>
            </div>
        </div>
    </section>

    <!-- Slide 10 -->
    <section class="slide" data-notes="This demonstrates that 3D spatial layout is specified by transformation, not static structure. The same retinal projection can specify different 3D layouts depending on the flow pattern. Pause and play to see how motion disambiguates depth.">
        <div class="slide-content">
            <h2 class="reveal">Interactive Demo - Optical Flow Specificity</h2>
            <h3 class="reveal">3D Layout from Transformation</h3>
            <div class="demo-container reveal">
                <iframe src="demos/optical_flow_specificity/index.html" width="100%" height="600px" frameborder="0"></iframe>
            </div>
        </div>
    </section>

    <!-- Slide 11 -->
    <section class="slide" data-notes="This bridges Stoffregen's findings with deeper mechanistic understanding. The peripheral retina's specialization for lamellar flow complements the fact that peripheral vision naturally encounters more lamellar flow during locomotion. Form follows function.">
        <div class="slide-content">
            <h2 class="reveal">Retinal Specialization and Flow Structure</h2>
            <h3 class="reveal">It's Not Just Retinal Location</h3>
            <ul class="reveal">
                <li><strong>Peripheral retina</strong> appears specialized for pickup of <strong>lamellar</strong> (parallel) flow, not radial flow</li>
                <li><strong>Retinal location</strong> is not the whole story</li>
                <li><strong>Structure of the ambient optic array</strong> also matters (radial vs. lamellar)</li>
                <li>Retinal specialization and AOA structure are <strong>complementary</strong></li>
            </ul>
            <p class="reveal" style="font-size: 0.9rem; margin-top: 2rem;"><strong>Reference:</strong> Stoffregen, T. A. (1985). Flow structure versus retinal location in the optical control of stance. <em>Journal of Experimental Psychology: Human Perception and Performance, 11</em>(5), 554–565.</p>
        </div>
    </section>

    <!-- Slide 12 -->
    <section class="slide" data-notes="We can separate Retinal Flow (eye + move) from Ambient Flow (move only). Heading judgments are accurate to within 1 degree.">
        <div class="slide-content">
            <h3 class="reveal">Rule 2: Heading Perception</h3>
            <h2 class="reveal">Can we see where we are going? (Warren, 1988)</h2>
            <ul class="reveal">
                <li><strong>Focus of Expansion (FOE):</strong> The point from which all flow originates.</li>
                <li><strong>Problem:</strong> Eye movements disrupt the FOE on the retina.</li>
                <li><strong>Result:</strong> We can separate <em>Retinal Flow</em> (eye + move) from <em>Ambient Flow</em> (move only). Heading judgments are accurate to within 1°.</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_11_img_2.png" alt="Retinal vs Ambient Flow"></div>
                <div class="img-container"><img src="assets/slide_12_img_1.png" alt="Heading Data"></div>
            </div>
        </div>
    </section>

    <!-- Slide 13 -->
    <section class="slide" data-notes="The conflict: Prism glasses in VR displace flow 10 degrees. Do we walk towards the visual target or the flow singularity?">
        <div class="slide-content">
            <h3 class="reveal">Rule 3: Visual Control of Steering</h3>
            <h2 class="reveal">The "Great Debate" (Warren et al., 2001)</h2>
            <ul class="reveal">
                <li><strong>Hypothesis A (Optic Flow):</strong> Steer by keeping FOE on the goal.</li>
                <li><strong>Hypothesis B (Egocentric Direction):</strong> Steer by keeping the goal centered in body.</li>
                <li><strong>The Conflict:</strong> Prism glasses in VR (displace flow 10°).</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_13_img_2.png" alt="Locomotor Axis"></div>
                <div class="img-container"><img src="assets/slide_14_img_1.png" alt="VR Setup"></div>
            </div>
        </div>
    </section>

    <!-- Slide 14 -->
    <section class="slide" data-notes="This is the key takeaway for Module 3. The visual system is an 'Adaptive Controller.' It doesn't use a single rigid rule; it combines information based on reliability.">
        <div class="slide-content">
            <h2 class="reveal">Adaptive Control Laws</h2>
            <h3 class="reveal">It's Not "Either/Or"</h3>
            <ul class="reveal">
                <li><strong>Sparse World:</strong> We use Egocentric Direction (walk curved paths).</li>
                <li><strong>Textured World:</strong> We use Optic Flow (walk straight paths).</li>
                <li><strong>Control Law:</strong> We flexibly weight flow based on environmental structure.</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_17_img_1.png" alt="Path Results"></div>
            </div>
        </div>
    </section>

    <!-- Slide 15 -->
    <section class="slide" data-notes="Direct Perception of Time-to-Contact. Inverse relationship: Fast expansion = Low Tau (Crash). Slow expansion = High Tau (Safe).">
        <div class="slide-content">
            <h3 class="reveal">Rule 4: Time-to-Contact</h3>
            <h2 class="reveal">Tau (τ) Theory</h2>
            <ul class="reveal">
                <li><strong>Indirect View:</strong> Calculate T = Distance / Speed. (Hard to estimate!)</li>
                <li><strong>Direct View:</strong> τ = 1 / Rate of Expansion. (Directly visible!)</li>
                <li><strong>Inverse Relationship:</strong> Fast expansion = Low Tau (Crash imminent). Slow expansion = High Tau (Safe).</li>
            </ul>
            <div class="grid reveal">
                <div class="img-container"><img src="assets/slide_22_img_1.png" alt="Tau Geometry"></div>
                <div class="img-container"><img src="assets/slide_22_img_2.png" alt="Expansion Diagram"></div>
            </div>
        </div>
    </section>

    <!-- Slide 16 -->
    <section class="slide" data-notes="This proves we couple action to optical invariants, not mental calculations of distance. The ball is getting closer, but optics say 'far away', so they grasp late.">
        <div class="slide-content">
            <h3 class="reveal">Testing Tau</h3>
            <h2 class="reveal">The Deflating Ball (Savelsbergh et al., 1991)</h2>
            <ul class="reveal">
                <li><strong>Experiment:</strong> Catch a ball that <em>deflates</em> while approaching.</li>
                <li><strong>Physics:</strong> Distance/Speed are normal.</li>
                <li><strong>Optics:</strong> Rate of expansion decreases (looks like it's slowing down or moving away).</li>
                <li><strong>Result:</strong> People grasp <strong>LATE</strong>. They trust the optics (τ), not the physics.</li>
            </ul>
        </div>
    </section>

    <!-- Slide 17 -->
    <section class="slide" data-notes="Direct Perception of Dynamics. We see the FORCE (severity) in the KINEMATICS (optics).">
        <div class="slide-content">
            <h3 class="reveal">Beyond Timing</h3>
            <h2 class="reveal">Collision Severity (Tau-dot)</h2>
            <p class="reveal">We don't just see <em>when</em> (Tau); we see <em>how hard</em> (Tau-dot).</p>
            <ul class="reveal">
                <li><strong>τ̇ ≥ -0.5:</strong> Safe stop (Soft collision).</li>
                <li><strong>τ̇ < -0.5:</strong> Crash (Hard collision).</li>
            </ul>
            <p class="reveal" style="font-weight: 700; margin-top: 1rem;">Direct Perception of Dynamics.</p>
        </div>
    </section>

    <!-- Slide 18 -->
    <section class="slide" data-notes="This extends the steering research to dynamic targets. Real-world locomotion often involves moving targets (other people, vehicles, prey, predators). The visual system flexibly combines multiple information sources depending on task demands and environmental reliability.">
        <div class="slide-content">
            <h2 class="reveal">Beyond Stationary Targets</h2>
            <h3 class="reveal">Pursuit and Interception (Fajen & Warren, 2004)</h3>
            <p class="reveal"><strong>Question:</strong> How do people walk to a <strong>moving</strong> target? What visual information guides pursuit?</p>
            <ul class="reveal">
                <li><strong>β</strong> (beta) = target-heading angle (bearing angle)</li>
                <li><strong>Two strategies:</strong>
                    <ul style="margin-top: 0.5rem;">
                        <li><strong>Pursuit:</strong> Continuously nullify the bearing angle (keep target centered)</li>
                        <li><strong>Interception:</strong> Predict future location and walk to intercept point</li>
                    </ul>
                </li>
            </ul>
            <p class="reveal"><strong>Information sources:</strong></p>
            <ul class="reveal">
                <li>Egocentric direction (where is target relative to body?)</li>
                <li>Global optic flow (where am I heading?)</li>
                <li>Local optic flow (how is target moving relative to background?)</li>
            </ul>
            <p class="reveal" style="font-weight: 700;"><strong>Result:</strong> People use a <strong>combination strategy</strong> - primarily pursuit with flow-based corrections</p>
        </div>
    </section>

    <!-- Slide 19 -->
    <section class="slide" data-notes="Action generates new flow, closing the loop. We don't 'process' light; we detect invariants to control action.">
        <div class="slide-content">
            <h2 class="reveal">Summary</h2>
            <h3 class="reveal">The Perception-Action Loop</h3>
            <div style="border-left: 4px solid var(--accent); padding-left: 2rem;" class="reveal">
                <p><strong>Radiant Light</strong> becomes <strong>Ambient Information</strong>.</p>
                <p>We detect invariants (<strong>Flow, FOE, Tau</strong>).</p>
                <p>These invariants directly control action (<strong>Balance, Steering, Braking</strong>).</p>
                <p>Action generates new flow, closing the loop.</p>
            </div>
        </div>
    </section>

    <script>
        class SlidePresentation {
            constructor() {
                this.slides = document.querySelectorAll('.slide');
                this.navDots = document.getElementById('navDots');
                this.progressBar = document.getElementById('progressBar');
                this.notesPanel = document.getElementById('notesPanel');
                this.notesContent = document.getElementById('notesContent');
                this.currentSlideIndex = 0;

                // Sync & Presenter Mode
                this.channel = new BroadcastChannel('slide_sync');
                this.startTime = Date.now();
                this.isPresenterWindow = window.location.hash === '#presenter';

                this.init();
            }

            init() {
                if (this.isPresenterWindow) {
                    document.body.classList.add('is-presenter');
                    this.startTimer();
                }

                // Create dots
                this.slides.forEach((_, i) => {
                    const dot = document.createElement('div');
                    dot.classList.add('dot');
                    dot.addEventListener('click', () => this.goToSlide(i));
                    this.navDots.appendChild(dot);
                });

                // Observer for animations and active dot
                const observerOptions = {
                    threshold: 0.6
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                            const index = Array.from(this.slides).indexOf(entry.target);
                            this.updateActiveState(index, true); // true = emit sync
                        }
                    });
                }, observerOptions);

                this.slides.forEach(slide => observer.observe(slide));

                // Keyboard Nav
                window.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowDown' || e.key === 'ArrowRight' || e.key === ' ') {
                        this.nextSlide();
                    } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                        this.prevSlide();
                    } else if (e.key.toLowerCase() === 'n') {
                        this.toggleNotes();
                    } else if (e.key.toLowerCase() === 'p' && !this.isPresenterWindow) {
                        this.openPresenterWindow();
                    }
                });

                // Listen for sync from other windows
                this.channel.onmessage = (event) => {
                    if (event.data.type === 'GOTO_SLIDE') {
                        this.updateActiveState(event.data.index, false); // false = don't re-emit
                        if (!this.isPresenterWindow) {
                            this.slides[event.data.index].scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                };

                this.updateActiveState(0);
            }

            openPresenterWindow() {
                const url = window.location.href.split('#')[0] + '#presenter';
                window.open(url, 'PresenterWindow', 'width=1200,height=800');
            }

            startTimer() {
                const timerEl = document.getElementById('pTimer');
                setInterval(() => {
                    const elapsed = Date.now() - this.startTime;
                    const h = Math.floor(elapsed / 3600000).toString().padStart(2, '0');
                    const m = Math.floor((elapsed % 3600000) / 60000).toString().padStart(2, '0');
                    const s = Math.floor((elapsed % 60000) / 1000).toString().padStart(2, '0');
                    timerEl.innerText = `${h}:${m}:${s}`;
                }, 1000);
            }

            updateActiveState(index, shouldEmit = true) {
                this.currentSlideIndex = index;

                // Update dots
                const dots = document.querySelectorAll('.dot');
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });

                // Update Progress
                const progressWidth = ((index + 1) / this.slides.length) * 100;
                this.progressBar.style.width = `${progressWidth}%`;

                // Update Notes
                const activeSlide = this.slides[index];
                const notes = activeSlide.getAttribute('data-notes');
                const content = activeSlide.querySelector('.slide-content').innerHTML;

                if (this.notesContent) {
                    this.notesContent.innerHTML = notes ? `<p style="font-size: 1rem; color: #333;">${notes}</p>` : `<p style="opacity: 0.5;">No notes.</p>`;
                }

                // Update Presenter UI if in presenter mode
                if (this.isPresenterWindow) {
                    document.getElementById('pSlideNum').innerText = `Slide ${index + 1} / ${this.slides.length}`;

                    const pCurrentBox = document.getElementById('pCurrentBox');
                    pCurrentBox.innerHTML = `<div class="slide-content">${content}</div>`;

                    document.getElementById('pNotes').innerHTML = notes || "No notes for this slide.";

                    const nextSlide = this.slides[index + 1];
                    if (nextSlide) {
                        const nextTitle = nextSlide.querySelector('h2')?.innerText || "Next Slide";
                        document.getElementById('pNextContent').innerText = `NEXT: ${nextTitle}`;
                    } else {
                        document.getElementById('pNextContent').innerText = "END OF DECK";
                    }
                }

                // Sync other windows
                if (shouldEmit) {
                    this.channel.postMessage({ type: 'GOTO_SLIDE', index: index });
                }
            }

            goToSlide(index) {
                this.slides[index].scrollIntoView({ behavior: 'smooth' });
            }

            nextSlide() {
                if (this.currentSlideIndex < this.slides.length - 1) {
                    this.goToSlide(this.currentSlideIndex + 1);
                }
            }

            prevSlide() {
                if (this.currentSlideIndex > 0) {
                    this.goToSlide(this.currentSlideIndex - 1);
                }
            }

            toggleNotes() {
                this.notesPanel.classList.toggle('active');
            }
        }

        // Initialize presentation
        window.addEventListener('DOMContentLoaded', () => {
            new SlidePresentation();
        });
    </script>
</body>
</html>
